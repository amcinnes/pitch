<!doctype html>
<html>
<head>
<title>Web Audio</title>
<style>
#canvas {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', () => {
	const canvas = document.getElementById('canvas')
	const cx = canvas.getContext('2d')
	const ac = new AudioContext()
	const analyser = ac.createAnalyser({fftSize: 2048})
	const waveform = new Float32Array(analyser.fftSize)

	window.addEventListener('resize', resize)

	resize()

	navigator.mediaDevices.getUserMedia({audio: true}).then((stream) => {
		const msasn = ac.createMediaStreamSource(stream)
		msasn.connect(analyser)

		draw()
	})

	function resize() {
		canvas.width = canvas.scrollWidth
		canvas.height = canvas.scrollHeight
	}

	function draw() {
		requestAnimationFrame(draw)
		analyser.getFloatTimeDomainData(waveform)
		cx.fillStyle = 'rgb(255, 255, 255)'
		cx.fillRect(0, 0, canvas.width, canvas.height)
		cx.beginPath()
		for (var i = 0; i < analyser.fftSize; i++) {
			const x = i / analyser.fftSize * canvas.width
			const y = waveform[i] * (canvas.height / 2) + canvas.height / 2
			if (i == 0) {
				cx.moveTo(x, y)
			} else {
				cx.lineTo(x, y)
			}
		}
		cx.stroke()
	}
})
</script>
</head>
<body>
<canvas id="canvas"></canvas>
</body>
</html>
